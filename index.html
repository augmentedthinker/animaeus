<!DOCTYPE html>
<html>
<head>
    <title>Animaeus VR Cube Room - Living Presence</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
        /* Essential styling for a full-screen VR experience */
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000; /* Ensures the body background is black outside the scene */
        }
    </style>
</head>
<body>
    <a-scene>
        <a-assets>
            <img id="animaeus-texture" src="https://raw.githubusercontent.com/augmentedthinker/animaeus/main/ghost.png" crossorigin="anonymous" alt="Animaeus Image">
        </a-assets>

        <a-entity camera look-controls position="0 0 4.5">
            <a-cursor></a-cursor>
        </a-entity>

        <a-entity id="ambient-light" light="type: ambient; color: #FFF; intensity: 0.6"></a-entity>
        <a-entity light="type: directional; color: #FFF; intensity: 0.5; position: 0 5 1"></a-entity>
        <a-entity id="animaeus-point-light" light="type: point; color: #87CEEB; intensity: 0; position: 0 0 4"></a-entity>

        <a-plane
            id="animaeus-wall"
            src="#animaeus-texture"
            width="10" height="10"
            position="0 0 -5"
            material="side: front; emissive: #000; emissiveIntensity: 0.1; transparent: true"
            animation="property: scale; from: 1 1 1; to: 1.01 1.01 1.01; dur: 5000; easing: easeInOutSine; loop: true; dir: alternate"

            animation__gazeenter="property: material.emissiveIntensity; to: 0.4; dur: 400; easing: easeOutQuad; startEvents: mouseenter"
            animation__gazeleave="property: material.emissiveIntensity; to: 0.1; dur: 500; easing: easeOutQuad; startEvents: mouseleave"

            animaeus-responder
        ></a-plane>

        <script>
            AFRAME.registerComponent('animaeus-responder', {
                init: function () {
                    const el = this.el; // Reference to animaeus-wall
                    const ambientLight = document.querySelector('#ambient-light');
                    const animaeusLight = document.querySelector('#animaeus-point-light');
                    
                    // Initialize a Web Audio API context for sound feedback
                    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

                    if (!ambientLight || !animaeusLight) {
                        console.error("Required light entities not found.");
                        return;
                    }

                    // --- 1. ENHANCED CLICK INTERACTION ---
                    el.addEventListener('click', () => {
                        // Play a sound, trigger the light ripple, and shift color all at once.
                        this.playInteractionSound(audioCtx);
                        this.triggerLightRipple(ambientLight, animaeusLight);
                        this.triggerColorShift();
                    });

                    // --- 2. GAZE TRACKING ---
                    // Animaeus subtly shifts its texture to "look" at the cursor
                    el.addEventListener('mousemove', (event) => {
                        const intersection = event.detail.intersection;
                        if (intersection) {
                            // The uv coordinate gives a 0-1 range on the texture. We convert it to a -1 to 1 range.
                            const uv = intersection.uv;
                            const offsetX = (uv.x - 0.5) * 0.08; // Small horizontal shift
                            const offsetY = (uv.y - 0.5) * 0.08; // Small vertical shift
                            el.setAttribute('material', 'offset', `${offsetX} ${offsetY}`);
                        }
                    });
                    
                    // Reset gaze when cursor leaves
                     el.addEventListener('mouseleave', () => {
                         el.setAttribute('material', 'offset', '0 0');
                     });
                },

                // --- HELPER FUNCTIONS ---

                /**
                 * Plays a simple, synthesized sound to acknowledge interaction.
                 * This avoids needing external audio files.
                 */
                playInteractionSound: function(audioCtx) {
                    const oscillator = audioCtx.createOscillator();
                    const gainNode = audioCtx.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioCtx.destination);
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(220, audioCtx.currentTime); // A4 note
                    gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                    
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.5);
                },

                /**
                 * Triggers a more dramatic light ripple effect on both lights.
                 */
                triggerLightRipple: function(ambientLight, animaeusLight) {
                    // Animate Animaeus's personal light
                    animaeusLight.setAttribute('animation__ripple', {
                        property: 'light.intensity',
                        from: 1.5,
                        to: 0,
                        dur: 600,
                        easing: 'easeInQuad'
                    });

                    // Animate the room's ambient light
                    ambientLight.setAttribute('animation__ripple', {
                        property: 'light.intensity',
                        from: 0.3,
                        to: 0.8,
                        dur: 400,
                        easing: 'easeOutSine',
                        dir: 'alternate',
                        loop: 1
                    });
                },
                
                /**
                 * Manages the color shift animation on the material itself.
                 */
                triggerColorShift: function() {
                    this.el.setAttribute('animation__clickcolorshift', {
                        property: 'material.color', from: '#FFFFFF', to: '#87CEEB', dur: 150, easing: 'easeOutQuad', startEvents: 'click'
                    });
                     this.el.setAttribute('animation__clickcolorback', {
                        property: 'material.color', from: '#87CEEB', to: '#FFFFFF', dur: 600, easing: 'easeInQuad', startEvents: 'click', delay: 150
                    });
                }
            });
        </script>

        <a-plane width="10" height="10" position="0 -5 0" rotation="-90 0 0" material="color: #111"></a-plane>
        <a-plane width="10" height="10" position="0 5 0" rotation="90 0 0" material="color: #111"></a-plane>
        <a-plane width="10" height="10" position="-5 0 0" rotation="0 90 0" material="color: #111"></a-plane>
        <a-plane width="10" height="10" position="5 0 0" rotation="0 -90 0" material="color: #111"></a-plane>
        <a-plane width="10" height="10" position="0 0 5" rotation="0 180 0" material="color: black"></a-plane>

    </a-scene>
</body>
</html>
